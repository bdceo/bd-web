<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<title>json3.html</title>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<script type="text/javascript" src="../js/json.js"></script>
		<script type="text/javascript" src="json-pager.js"></script>
		<script type="text/javascript" src="../js/jquery-1.3.js"></script>		
		<style>a{TEXT-DECORATION:none}</style>
		<script type="text/javascript">
			var pageNo,pageSize,pageCount,rowCount;
			var jsonObj={users:[]};
			var users=jsonObj.users;
			function init(param){	
				var size=parseInt(param);//数据类型转换				
				for(var i=1;i<=size;i++){
					var user;
					if(i%3==0){
						user={name:"user"+i,sex:"男",phone:i+"-112",email:"sss@ww.com"}
					}else{
						user={name:"user"+i,sex:"女",phone:i+"-154",email:"www@ss.com"};
					}
					users.push(user);
				}				
				//计算分页数据
				pageNo=1;pageSize=10;rowCount=size;
				pageCount=Math.round((size+pageSize-1)/pageSize);
				//显示数据
				pager(1);
				//显示分页控件
				
			}
			function first(){//首页
				if(pageNo==1){
					alert("当前已经是第一页了。");
					return false;
				}else{
					pager(1);
				}
			}
			function up(){//上一页
				if(pageNo==1){
					alert("当前已经是第一页了。");
					return false;
				}else{
					pager(pageNo-1);
				}
			}
			function down(){//下一页
				if(pageNo==pageCount){
					alert("当前已经是最后一页了。");
					return false;
				}else{
					pager(pageNo+1);
				}
			}
			function last(){//尾页
				if(pageNo==pageCount){
					alert("当前已经是最后一页了。");
					return false;
				}else{
					pager(pageCount);
				}
			}
			function pager(param){
				pageNo=parseInt(param);
				var data=jsonObj.users; 
				var max=pageNo*pageSize;
				if(pageNo==pageCount){
					max=rowCount;
				}
				//清理树的数据
				$("#uts2>tbody").remove();
				var trtd="<tbody>";
				for(var i=(pageNo-1)*pageSize+1-1;i<max;i++){
					var u=data[i];
					trtd+="<tr><td>"+u.name+"</td><td>"+u.sex+"</td><td>"
							+u.phone+"</td><td>"+u.email+"</td></tr>";						
				}	
				trtd+="</tbody>";
				$("#uts2").append(trtd);
				//刷新分页标签
				var end=pageSize*pageNo;
				if(pageNo==pageCount){
					end=rowCount;
				}
				$("#pagerInfo").html((pageNo-1)*pageSize+1+"-"+end+"/"+rowCount);
				$("#pagerLink").empty();
				var k=pageCount+1-pageNo;
				if(k==2){
					$("#pagerLink").append("&nbsp<a style='cursor:hand' onclick='pager("+(pageNo-1)+")'>"+(pageNo-1)+"</a>&nbsp");						
				} 
				if(k==1){
					$("#pagerLink").append("&nbsp<a style='cursor:hand' onclick='pager("+(pageNo-2)+")'>"+(pageNo-2)+"</a>&nbsp");
					$("#pagerLink").append("&nbsp<a style='cursor:hand' onclick='pager("+(pageNo-1)+")'>"+(pageNo-1)+"</a>&nbsp");
				}
				for(var i=pageNo;i<=pageCount&&i<pageNo+3;i++){
					if(i==pageNo){
						$("#pagerLink").append("&nbsp<a style='cursor:hand' onclick='pager("+i+")'><font color='red'>"+i+"</font></a>&nbsp");
					}else{
						$("#pagerLink").append("&nbsp<a style='cursor:hand' onclick='pager("+i+")'>"+i+"</a>&nbsp");
					}
				}
			}
		</script>
	</head>
	<body>
		<h2>
			测试 JS 分页<input type="button" onclick="init('44')" value=" 初始化..."/>
		</h2>
		<hr />
		<table id="uts1" border="1" width="500px" bgcolor="#eeeeee">
			<tr>
				<th>姓名</th><th>性别</th><th>电话</th><th>邮箱</th>
			</tr>
		</table>
		<table id="uts2" border="1" width="500px" >
			<tbody></tbody>
		</table><br>
		<table border="0" cellspacing="0" cellpadding="0" width="500px">
			<tr>
				<td align="left"><div id="pagerInfo">1-10/10</div></td>
				<td align="right">
					<a onclick="first()" style="cursor:hand" title="首页">&nbsp;&lt;&lt;&nbsp;</a>
					<a onclick="up()" style="cursor:hand" title="上一页">&nbsp;&lt;&nbsp;</a>
					<div id="pagerLink"></div>
					&nbsp;<a onclick="down()" style="cursor:hand" title="下一页">&nbsp;&gt;&nbsp;</a>
					<a onclick="last()" style="cursor:hand" title="尾页">&nbsp;&gt;&gt;&nbsp;</a>
				</td>
			</tr>
		</table>			
	</body>
</html>
